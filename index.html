<html>

    <head>
        <title>LinkedIn lead parser</title>
        <script language="javascript">
"use strict";
var tokens = ["FI", "LI", "FN", "LN"];

function isSalesNavigator(line, previousLine){
    if (previousLine == ""){
      return false;  
    } 
    var retVal = line.search(/TeamLink$|Saved$|3rd$|2nd$|Open link$|1st$/);
    return (retVal > 0);
}

function isRegularLI(line){
    var retVal = line.search(/^  .*/);
    return (retVal == 0);
}

function isCrazyLI(prevLine, line){
    if (prevLine == ""){
        return (crazyMatch(line) > 0); 
    }
    return false;
}

function crazyMatch(line){
    var position = line.search(/TeamLink|Premium Badge|3rd|2nd|Open link|1st|GROUP/);
    return position;
}

function figureOutNames(string){
    var ary = string.split(" ");
    if (ary.length > 2){
        // join together everything after second index
        return new Array(ary[0], string.substring(string.search(" ")));
    }
    else {
        return new Array(ary[0], ary[1]);
    }
}

function parseIt() {
    var numMatches = 0;
    
    var textArea = document.getElementById("src");
    var lines = textArea.value.split("\n"); // arrayOfLines is array where every element is string of one line

    var output = "";
    var table = "<table>";

    for (var i = 0; i < lines.length; i++) {
        //code here using lines[i] which will give you each line
        // look for lines ending with "Saved"; previous line will be name, following line is title. Add those two to the output separated by a tab.
        if (isSalesNavigator(lines[i], lines[i-1])){
            numMatches++;
            
            var fullName = lines[i-1];

            var nameSplit = figureOutNames(fullName);

            var firstName = nameSplit[0];
            var lastName = nameSplit[1];

            var eml = email(firstName, lastName);
            var title = lines[i + 1].replace(/ at .+$/, "");
            var location = getSNLocation(lines[i+2]);

            if (document.getElementById("nameColumn").selectedIndex == 0) {  // name goes in two columns
                table = table + "<tr><td><b>" + firstName + "</b></td><td><b>" + lastName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } else {
            table = table + "<tr><td><b>" + fullName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } 
        } else if (isRegularLI(lines[i])) {
            numMatches++;
            
            var fullName = lines[i].replace(/^  /,"");

            var nameSplit = figureOutNames(fullName);

            var firstName = nameSplit[0];
            var lastName = nameSplit[1];

            var eml = email(firstName, lastName);
            var title = lines[i + 1].replace(/ at .+$/, "");
            var location = "";

           if (document.getElementById("nameColumn").selectedIndex == 0) {  // name goes in two columns
                table = table + "<tr><td><b>" + firstName + "</b></td><td><b>" + lastName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } else {
                table = table + "<tr><td><b>" + fullName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } 
        }  else if (i>0 && isCrazyLI(lines[i-1], lines[i])){
            numMatches++;

            var fullName = lines[i].substring(0, crazyMatch(lines[i]));
            var nameSplit = figureOutNames(fullName);


            var firstName = nameSplit[0];
            var lastName = nameSplit[1];

            var eml = email(firstName, lastName);
            var title = lines[i + 1].replace(/ at .+$/, "");
            var location = "";

           if (document.getElementById("nameColumn").selectedIndex == 0) {  // name goes in two columns
                table = table + "<tr><td><b>" + firstName + "</b></td><td><b>" + lastName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } else {
                table = table + "<tr><td><b>" + fullName + "</b></td><td>" + location + "</td><td>" + title + "</td><td><a href='mailto:" + eml + "'>" + eml + "</a></td></tr>";
            } 
        }
    }
    table = table + "</table>";

    document.getElementById("table").innerHTML = "Parsed " + numMatches + " leads.<br><br>" + table;
    //document.getElementById("dst").value = output;
}

function getSNLocation (locString){
    var string = locString.match(/Location(.*)Industry/);
    if (string[1]) return string[1];
    else return "";
}

function email(firstName, lastName) {

    var pat = document.getElementById("pat").value;
    
    // add brackets back into the pattern
    for (var i = 0; i < tokens.length; i++)
        pat = pat.replace(tokens[i], "{" + tokens[i] + "}");

    var firstInit = firstName.charAt(0);
    var lastInit = lastName.charAt(0);

    var nameAry = [firstInit, lastInit, firstName, lastName];

    // iterate over each replacement token and do the substitution
    for (var i = 0; i < tokens.length; i++)
        pat = pat.replace("{" + tokens[i] + "}", nameAry[i]);

    return pat;
}

function toggleHelp(){
    var hlp = document.getElementById('help').style.visibility;
    if(hlp=='visible')
        document.getElementById('help').style.visibility='hidden';
    else
        document.getElementById('help').style.visibility='visible';
}
        </script>
        
        <style>
            @font-face {
  font-family: "TitilliumText22LRegular";
  font-style: normal;
  font-weight: normal;
  src: url("http://www.cloudera.com/etc/designs/cloudera/static/font/titillium/TitilliumText22L003-webfont.eot?#iefix") format("embedded-opentype"), url("http://www.cloudera.com/etc/designs/cloudera/static/font/titillium/TitilliumText22L003-webfont.woff") format("woff"), url("http://www.cloudera.com/etc/designs/cloudera/static/font/titillium/TitilliumText22L003-webfont.ttf") format("truetype"), url("http://www.cloudera.com/etc/designs/cloudera/static/font/titillium/TitilliumText22L003-webfont.svg#titillium/TitilliumText22LRegular") format("svg");
}
body {
    color: #005879;
font-family: "TitilliumText22LRegular",Arial,sans-serif;
font-size: 13.6px;
font-style: normal;
font-weight: 400;
    
}

h1 {
    color: #005879;
font-family: "TitilliumText22LRegular",Arial,sans-serif;
font-size: 17px;
font-style: normal;
font-weight: 400;

}
        </style>
    </head>


    <body>
        
<div style="font-size:20px;margin-top:5px"><img src="http://www.cloudera.com/content/dam/cloudera/logos/Cloudera_logo_rgb.png" style="width: 168px;margin-bottom:15px;margin-right:25px" valign="left" align="middle">LinkedIn Lead Parser by <a href="mailto:droman@cloudera.com">Daniel Roman</a> | 2015-Aug-03 | <a href="https://www.linkedin.com/sales/?trk=nav_logo"><img src="https://static.licdn.com/scds/common/u/images/logos/linkedin/logo_in_nav_retina_88x72.png" width="22">Sales Navigator</a></div>

        <form name="li">
            <input type="text" id="pat" value="FILN@company.com" size="40" onChange="parseIt();">
            <input type="hidden" id="code">
            <a href="javascript:alert('Use any of the following tokens to infer email addresses for this organization. Don\'t forget to put the right domain name at the end. FI=First Initial, LI=Last Initial, FN=First Name, LN=Last Name');"><i>Substitution keys: FI, LI, FN, LN</i></a>
            <button type="submit" form="li" onClick="parseIt();">Parse leads</button>
            <select id="nameColumn" onChange="parseIt();"><option selected>First and last name in separate columns</option><option>Full name in one column</option></select>
            <br>
            <textarea rows="5" cols="120" id="src" onChange='parseIt();'></textarea>
            <br>
            <!--<textarea id="dst" rows=4 cols=120></textarea>-->
            <br>
            <div id='table'></div>
        </form>
       <h1><a href="javascript:toggleHelp();">Learn how to use this tool</a></h1>
 <iframe id="help" style="visibility:hidden" src="https://app.box.com/embed/preview/ovxxtl6evfh5bbegw3qxpbquufx27wrl?view=&sort=&direction=ASC&theme=light" width="800" height="450" frameborder="0"allowfullscreen webkitallowfullscreen msallowfullscreen></iframe>
    </body>

</html>
